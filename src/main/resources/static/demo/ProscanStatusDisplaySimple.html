<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- Load the Wica library last of all as it will generate events which interact with the page -->
    <script type="text/javascript" src="https://gfa-wica.psi.ch/wica.js" defer></script>

    <style>

        * {
            font-family: "Helvetica Neue",sans-serif;
        }

        body {
            background-color: darkgrey;
        }

        h1 {
            margin: 1rem;
            text-align: center;
        }

        label {
            display: inline-block;
            width: 15rem;
            text-align: right;
        }

        .statusWidget {
            height: 1.2rem;
            width:  1.5rem;
            background-color: lime;
        }

    </style>

</head>

<body>

    <h1>Wica Demo Page - PROSCAN Status Display</h1>

    <div>
        <h2>Connection Status</h2>
        <div class="statusWidget" data-wica-channel-name="XPROSCAN:TIME:2" onchange="dummy()">NC</div>
    </div>

    <div>
        <h2>Stream Data</h2>

        <label>PROSCAN Time    </label> <label data-wica-channel-name="XPROSCAN:TIME:2">NC </label> <br>
        <label>MMAC3           </label> <label data-wica-channel-name="MMAC3:STR:2">NC     </label> <br>
        <label>Green Box       </label> <label data-wica-channel-name="MMAV6:IST:2">NC     </label> <br>
        <label>SOL             </label> <label data-wica-channel-name="MMAC:SOL:2">NC      </label> <br>

        <label>Vdef.           </label> <label data-wica-channel-name="EMJCYV:IST:2">NC    </label> <br>
        <label>Vdef. Plus Sign </label> <label data-wica-channel-name="EMJCYV:STAW:1">NC   </label> <br>
        <!-- A=0x0021||A=0x0022-->

        <label>Degr.           </label> <label data-wica-channel-name="DMAD1:IST:2">NC    </label> <br>

        <label>Kicker          </label> <label data-wica-channel-name="AMAKI1:IST:2">NC    </label> <br>
        <label>HF              </label> <label data-wica-channel-name="CMJSEV:PWRF:2">NC   </label> <br>
        <label>HF              </label> <label data-wica-channel-name="CMJLL:SOLA:2">NC    </label> <br>
        <label>Extractor 1     </label> <label data-wica-channel-name="EMJEC1V:IST:2">NC   </label> <br>
        <label>Extractor 2     </label> <label data-wica-channel-name="EMJEC2V:IST:2">NC   </label> <br>
        <label>Hauptmagnet     </label> <label data-wica-channel-name="AMJHS-I:IADC:2">NC  </label> <br>
        <label>Phase           </label> <label data-wica-channel-name="MMJF:IST:2">NC      </label> <br>

        <label>Ionenquelle 1   </label> <label data-wica-channel-name="IMJV:IST:2">NC      </label> <br>
        <label>Ionenquelle 2   </label> <label data-wica-channel-name="IMJI:IST:2">NC      </label> <br>
        <label>Ionenquelle 3   </label> <label data-wica-channel-name="IMJGF:IST:2">NC     </label> <br>
        <label>Ionenquelle 4   </label> <label data-wica-channel-name="XPROIONS:IST1:2">NC </label> <br>

        <label>QMA1/2/3 1      </label> <label data-wica-channel-name="QMA1:IST:2">NC      </label> <br>
        <label>QMA1/2/3 2      </label> <label data-wica-channel-name="QMA2:IST:2">NC      </label> <br>
        <label>QMA1/2/3 3      </label> <label data-wica-channel-name="QMA3:IST:2">NC      </label> <br>

        <label>SMj1x2y 1       </label> <label data-wica-channel-name="SMJ1X:IST:2">NC     </label> <br>
        <label>SMj1x2y 2       </label> <label data-wica-channel-name="SMJ2Y:IST:2">NC     </label> <br>

        <label>SMA1x1y 1       </label> <label data-wica-channel-name="SMA1X:IST:2">NC     </label> <br>
        <label>SMA1x1y 2       </label> <label data-wica-channel-name="SMA1Y:IST:2">NC     </label> <br>

        <label>Ph Spalt 1/2 1  </label> <label data-wica-channel-name="MMJP2:IST1:2">NC    </label> <br>
        <label>Ph Spalt 1/2 2  </label> <label data-wica-channel-name="FMJEPI:POS:2">NC    </label> <br>
        <label>Ph Spalt 1/2 3  </label> <label data-wica-channel-name="FMJEPI:BREI:2">NC   </label> <br>
        <label>Ph Spalt 1/2 4  </label> <label data-wica-channel-name="MMJP2:IST2:2">NC    </label> <br>
        <label>Ph Spalt 1/2 5  </label> <label data-wica-channel-name="FMJIPI:POS:2">NC    </label> <br>
        <label>Ph Spalt 1/2 6  </label> <label data-wica-channel-name="FMJIPI:BREI:2">NC   </label> <br>

        <label>BMA1            </label> <label data-wica-channel-name="BMA1:STA:2">NC      </label> <br>
        <label>RPS  Bew. OK    </label> <label data-wica-channel-name="BMA1:STAR:2">NC     </label> <br>
        <label>PaSS Bew. OK    </label> <label data-wica-channel-name="BMA1:STAP:2">NC     </label> <br>

        <label>BMC1            </label> <label data-wica-channel-name="BMC1:STA:2">NC      </label> <br>
        <label>RPS  Bew. OK    </label> <label data-wica-channel-name="BMC1:STAR:2">NC     </label> <br>
        <label>PaSS Bew. OK    </label> <label data-wica-channel-name="BMC1:STAP:2">NC     </label> <br>

        <label>BME1            </label> <label data-wica-channel-name="BME1:STA:2">NC      </label> <br>
        <label>RPS  Bew. OK    </label> <label data-wica-channel-name="BME1:STAR:2">NC     </label> <br>
        <label>PaSS Bew. OK    </label> <label data-wica-channel-name="BME1:STAP:2">NC     </label> <br>

        <label>BMD1 Pif        </label> <label data-wica-channel-name="BMD1:STA:2">NC     </label> <br>
        <label>RPS  Bew. OK    </label> <label data-wica-channel-name="BMD1:STAR:2">NC     </label> <br>

        <label>BMB1 Gantry2    </label> <label data-wica-channel-name="BMB1:STA:2">NC      </label> <br>
        <label>RPS  Bew. OK    </label> <label data-wica-channel-name="BMB1:STAR:2">NC     </label> <br>
        <label>PaSS Bew. OK    </label> <label data-wica-channel-name="BMB1:STAP:2">NC     </label> <br>

        <label>BMD2 Gantry3    </label> <label data-wica-channel-name="BMD2:STA:2">NC      </label> <br>
        <label>RPS  Bew. OK    </label> <label data-wica-channel-name="BMD2:STAR:2">NC     </label> <br>
        <label>PaSS Bew. OK    </label> <label data-wica-channel-name="BMD2:STAP:2">NC     </label> <br>

        <label>Mastership      </label> <label data-wica-channel-name="XPROSCAN:STAB:2">NC </label> <br>

        <label>Schildku 1      </label> <label data-wica-channel-name="YMJCS1K:IST:2">NC   </label> <br>
        <label>Schildku 2      </label> <label data-wica-channel-name="YMJCS2K:IST:2">NC   </label> <br>

        <label>Heizleist. A    </label> <label id = "hzLeistungDataChannelA" data-wica-channel-name="YMJHH:SPARB:2">NC</label> <br>
        <label>Heizleist. B    </label> <label id = "hzLeistungDataChannelB" data-wica-channel-name="YMJHH:STR:2">NC</label> <br>
        <label>Heizleist. Calc </label> <label id = "hzLeistungCalculator">NC</label> <br>

        <label>He Level        </label> <label data-wica-channel-name="YMJHL:IST:2">NC     </label> <br>
        <label>He Druck        </label> <label data-wica-channel-name="YMJHG:IST:2">NC     </label> <br>
        <label>Bunker-Temp     </label> <label data-wica-channel-name="YMJKKRT:IST:2">NC   </label> <br>

        <label>Ionenquelle 1   </label> <label data-wica-channel-name="RPS-IQ:STA:1">NC    </label> <br>
        <label>Ionenquelle 2   </label> <label data-wica-channel-name="UMJSSB:BIQX:1">NC   </label> <br>

        <label>HF reduziert 1  </label> <label data-wica-channel-name="RPS-HFRD:STA:1">NC  </label> <br>
        <label>HF reduziert 2  </label> <label data-wica-channel-name="UMJSSB:BHRX:1">NC   </label> <br>

        <label>HF              </label> <label data-wica-channel-name="RPS-HF:STA:1">NC    </label> <br>
        <label>HF              </label> <label data-wica-channel-name="UMJSSB:BHFX:1">NC   </label> <br>

        <label>Ablenkplatte    </label> <label data-wica-channel-name="UMJSSB:BDEX:1">NC   </label> <br>

        <label>No Beam - A     </label> <label data-wica-channel-name="PRO:CURRENTALARM:1">NC </label> <br>
        <label>No Beam - B     </label> <label data-wica-channel-name="PRO:COUNT:1">NC       </label> <br>

    </div>

</body>

 <script>

    function dummy( event ) { }

    class CalculateHeizLeistung
    {
        constructor( calcDivId, channel1DataId, channel2DataId )
        {
            this.calculationOutputElement = CalculateHeizLeistung.validateNotNull( document.getElementById( calcDivId ) );
            this.channel1DataElement = CalculateHeizLeistung.validateNotNull( document.getElementById( channel1DataId ) );
            this.channel2DataElement = CalculateHeizLeistung.validateNotNull( document.getElementById( channel2DataId ) );

            // Required to overcome Javascript's strange variable scoping rules
            let that = this;

            // Trigger a task to calculate the Heizlestung every second
            setInterval( CalculateHeizLeistung.updateOutputElement, 1000, that );
        }

        static updateOutputElement( that )
        {
            if ( ( that.channel1DataElement.dataset.wicaChannelValue === undefined ) ||
                 ( that.channel2DataElement.dataset.wicaChannelValue === undefined ) )
            {
                return;
            }

            let channel1Value = JSON.parse( that.channel1DataElement.dataset.wicaChannelValue ).val;
            let channel2Value = JSON.parse( that.channel2DataElement.dataset.wicaChannelValue ).val;
            let calcResult = channel1Value * channel2Value;
            that.calculationOutputElement.textContent = ( calcResult ).toFixed( 2 ) + " W";
        }

        static validateNotNull( arg )
        {
            if ( arg === null )
            {
                throw "is Null";
            }
            else { return arg; }
        }
    }

    let heizLeistungCalc;
    heizLeistungCalc = new CalculateHeizLeistung( "hzLeistungCalculator", "hzLeistungDataChannelA", "hzLeistungDataChannelB" );

 </script>

</html>
